<!--
    Label Printer Service (78mm x 50mm)
    This single HTML file is responsible for:
    1. Loading data from URL parameters (name, phone, location, total).
    2. Styling the content for a 78mm x 50mm thermal label printer using CSS @page rules.
    3. Automatically triggering the print dialog.
-->
<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Label Print - 78x50mm</title>
    <!-- Load Tailwind CSS for utility styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Khmer:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans Khmer', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* ---------------------------------------------------- */
        /* CSS áŸá˜áŸ’ášá¶á”áŸ‹á€á¶ášá”áŸ„áŸ‡á–á»á˜áŸ’á– (Print Specific Styles) */
        /* ---------------------------------------------------- */
        @page {
            /* á€áŸ†áááŸ‹á‘áŸ†á áŸ† Label: 78mm x 50mm (Landscape Mode) */
            size: 78mm 50mm landscape;
            margin: 0; /* á›á»á” Margin á‘á¶áŸ†á„á¢áŸáŸ‹ */
        }

        .label-container {
            width: 78mm;
            height: 50mm;
            padding: 2mm; 
            box-sizing: border-box;
            background-color: white;
            border: 1px solid #ccc; /* áŸá˜áŸ’ášá¶á”áŸ‹á˜á¾á›áƒá¾á‰á€áŸ’á“á»á„ Browser á”áŸ‰á»ááŸ’ááŸ„áŸ‡ */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .print-only {
            display: none;
        }
        
        /* á“áŸ…á–áŸá›á”áŸ„áŸ‡á–á»á˜áŸ’á– */
        @media print {
            body {
                background: none;
                /* á”á„áŸ’á á¶á‰ááŸ‚ Container áŸá˜áŸ’ášá¶á”áŸ‹á”áŸ„áŸ‡á–á»á˜áŸ’á– */
                display: block; 
                margin: 0;
            }
            .label-container {
                border: none;
                box-shadow: none;
            }
            .no-print {
                display: none;
            }
            .print-only {
                display: block;
            }
        }
        
    </style>
</head>
<body>

    <!-- UI áŸá˜áŸ’ášá¶á”áŸ‹ Browser (áŸá˜áŸ’ášá¶á”áŸ‹á˜á¾á› á“á·á„á”á‰áŸ’á‡á¶ Print) -->
    <div class="no-print p-6 bg-white rounded-xl shadow-2xl m-4 max-w-md w-full">
        <h1 class="text-2xl font-bold mb-4 text-center text-gray-800">ğŸ“¦ á–á·á“á·ááŸ’á™ Label á˜á»á“á–áŸá›á–áŸ’ášá¸á“</h1>
        <p id="loading-message" class="text-center text-red-500 font-semibold mb-4">á€áŸ†á–á»á„ášá„áŸ‹á…á¶áŸ†á‘á·á“áŸ’á“á“áŸá™...</p>
        
        <!-- Label Preview Area -->
        <div id="label-preview" class="border-4 border-dashed border-indigo-300 p-2 my-4 rounded-lg bg-gray-50 flex justify-center items-center h-48">
            <div class="label-container shadow-lg">
                <!-- Data will be populated here by JavaScript -->
                <div class="text-center text-gray-400 text-sm italic">Label Preview (78mm x 50mm)</div>
            </div>
        </div>

        <!-- Print Button -->
        <button onclick="printLabel()" id="print-button" disabled
                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition duration-150 ease-in-out disabled:opacity-50">
            âœ… á…á»á…áŠá¾á˜áŸ’á”á¸á”áŸ„áŸ‡á–á»á˜áŸ’á– Label
        </button>
    </div>

    <!-- Label Container áŠáŸ‚á›á˜á¶á“á‘áŸ†á áŸ† 78x50mm áŸá˜áŸ’ášá¶á”áŸ‹á”áŸ„áŸ‡á–á»á˜áŸ’á– -->
    <div id="actual-label-container" class="print-only label-container">
        <!-- JS will clone content here for printing -->
    </div>

    <script>
        // áŸá˜áŸ’ášá¶á”áŸ‹á’áŸ’áœá¾á€á¶áš Encode/Decode URL
        function getUrlParams() {
            const params = {};
            // á”áŸ’ášá¾ URLSearchParams áŸá˜áŸ’ášá¶á”áŸ‹á‘á¶á‰á™á€ Query String
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            
            // á”áŸ’ášá˜á¼á›á‘á·á“áŸ’á“á“áŸá™
            params.name = urlParams.get('name') || 'N/A';
            params.phone = urlParams.get('phone') || 'N/A';
            params.location = urlParams.get('location') || 'N/A';
            params.total = urlParams.get('total') || '0.00';
            
            return params;
        }

        function populateLabel() {
            const data = getUrlParams();
            const previewContainer = document.querySelector('#label-preview .label-container');
            const actualContainer = document.getElementById('actual-label-container');
            const loadingMessage = document.getElementById('loading-message');
            const printButton = document.getElementById('print-button');

            if (data.name === 'N/A') {
                loadingMessage.textContent = "âš ï¸ á‘á·á“áŸ’á“á“áŸá™á˜á·á“á–áŸá‰á›áŸá‰ (Name á”á¶ááŸ‹)";
                return;
            }

            loadingMessage.textContent = "á‘á·á“áŸ’á“á“áŸá™ááŸ’ášá¼áœá”á¶á“á•áŸ’á‘á»á€áŠáŸ„á™á‡áŸ„á‚á‡áŸá™áŸ”";
            printButton.disabled = false;
            
            const content = `
                <div class="flex flex-col h-full text-xs text-gray-900 font-khmer">
                    <!-- Top Section: General Info & Name -->
                    <div class="flex justify-between items-center pb-1 border-b border-gray-900">
                        <span class="text-[8px] font-bold">Gadme Store</span>
                        <span class="text-[8px] font-bold">Total: $${data.total}</span>
                    </div>

                    <!-- Customer & Contact Info -->
                    <div class="mt-1 flex-grow">
                        <div class="mb-[2px] text-[10px]">
                            <span class="font-bold">ğŸ‘¤ áˆáŸ’á˜áŸ„áŸ‡:</span> ${data.name}
                        </div>
                        <div class="mb-[2px] text-[10px]">
                            <span class="font-bold">ğŸ“ á‘á¼ášáŸáŸá–áŸ’á‘:</span> ${data.phone}
                        </div>
                        <div class="text-[10px]">
                            <span class="font-bold">ğŸ“ á‘á¸áá¶áŸ†á„:</span> ${data.location}
                        </div>
                    </div>

                    <!-- Optional Barcode/QR Code Placeholder (for real-world scenario) -->
                    <div class="flex justify-center items-center pt-1 border-t border-gray-900 mt-auto">
                        <span class="text-[8px] italic">Scan for Order Details</span>
                    </div>
                </div>
            `;
            
            // á”á„áŸ’á á¶á‰á€áŸ’á“á»á„ Preview
            previewContainer.innerHTML = content;
            
            // á”á„áŸ’á á¶á‰á€áŸ’á“á»á„ Actual Print Container
            actualContainer.innerHTML = content;

            // ááŸ’ášáŸ€á˜ááŸ’á›á½á“áŸá˜áŸ’ášá¶á”áŸ‹ Print
            // window.print(); // uncomment á“áŸáŸ‡á”áŸ’ášáŸá·á“á”á¾á¢áŸ’á“á€á…á„áŸ‹á±áŸ’á™áœá¶ Print áŠáŸ„á™áŸáŸ’áœáŸá™á”áŸ’ášáœááŸ’áá·
        }

        function printLabel() {
            window.print();
        }

        window.onload = populateLabel;
        
    </script>
</body>
</html>
